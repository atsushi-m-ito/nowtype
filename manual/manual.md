# NowType is a Markdown Editor

NowTypeをご利用いただきありがとうございます。

NowTypeはMarkdown形式のテキストエディターです。一般的なMarkdownエディターは左右分割式の画面で、編集画面と表示画面がわかれていますが、NowTypeでは一画面だけを用いてWYSIWYG形式での編集を特徴としています。

ここではNowTypeを使ったMarkdown文章の記入操作方法を解説します。

## 段落

一般的にMarkdownでは文章の纏まりは段落となり、連続しない改行は無視されます。連続した改行、すなわち、空行があると、次の段落との区切りとなります。対応するHTMLタグ要素はPになります。

## 見出し

ただし、行の最初の文字列がシャープ`#`と半角スペースで始まる時、続く文字列は段落ではなく見出しとみなされます。`#`の数によって、見出しのレベルを6段階に設定できます。次の例を見てください。```
# 見出し1(Title)

ここが段落の文章になる
改行しても無視される

空行がある為この文章は第二段落となる

## 見出し2(Chapter)

### 見出し3(Section)

#### 見出し4(Subsection)

##### 見出し5

###### 見出し6

段落の文章
```

ここで6段階の見出しは、ちょうどHTMLの`H1`タグから`H6`タグに相当します。

NowTypeにおける入力では、見出しは次のように記入支援が行われます。

- 空の段落、もしくは、既存の段落の先頭にカーソルを合わせ、`#`を必要な数だけ入力したあと、**半角スペース**を入力すると、段落が見出しに変更されます。
- 既に見出しになっている部分では、見出しの先頭にカーソルを合わせて、`Tab`キーを入力すると、見出しのレベルを一つ上げる(数字を増やす)ことができます。また`Shift + Tab`キーを入力すると、見出しのレベルを一つ下げる(数字を減らす)ことができます。

## リスト

Markdownでは、二種類の箇条書き(リスト)として、番号無しリストと番号付きリストが使えます。

### 番号無しリスト

番号無しリストはMarkdownにおいては、行の最初の文字がマイナス記号`-`と半角スペースで始まった際に、続く文章をリストの要素とみなします。その行を連続して記述することで、ひと纏まりのリストとみなされます。また、二行目以降のリスト要素においては、マイナス記号`-`の前に2つ以上の半角スペースをインデントとして入力すると、前の行の子リスト要素になります。

例えば、次のようなMarkdownテキストを考えます。```
- リストA
- リストB
  - 子リストB-a
    - 孫リストB-a-a
- リストC
```
これは次のように表示されます。

- リストA
- リストB
  - 子リストB-a
    - 孫リストB-a-a
- リストC

ちょうどHTMLでは`UL`タグと`LI`タグに相当します。

NowTypeにおける入力では、番号無しリストは次のように記入支援が行われます。

- 空の段落、もしくは、既存の段落の先頭にカーソルを合わせ、`-`を入力したあと、**半角スペース**を入力すると、段落がリストに変更されます。見出しの作り方と同じです。
- 二行目以降のリストに置いて、文字列の先頭で`Tab`を入力すると、リストの階層が一つ下がり、子リストになります。ただし、階層は要談飛ばしにはできないので、上記の例でリストBの次が孫リストになることはできません。
- 逆に、文字列の先頭で`Shift + Tab`を入力すると、リストの階層が一つ上がります。最上位の階層で`Shift + Tab`を入力した場合は、段落に戻ります。

また、markdownの表記においては、リスト次の行に空行が無い場合に、続く文章の解釈が異なります。NowTypeで読み込む場合は、先頭の半角スペースが2つ以上存在する場合はリスト内の要素とみなし、存在しない場合は新しい段落とみなします。つまり、次のMarkdownテキスト```
- リストの文章1です。
  行の頭に半角スペースが二つあるので、リストの内部要素です。
- リストの文章2です。
行の頭に半角スペースが無いので新しい段落です。
```
に対して、NowTypeでは次の様に表示されます。

- リストの文章1です。行の頭に半角スペースが二つあるので、リストの内部要素です。
- リストの文章2です。

行の頭に半角スペースが無いので新しい段落です。

### 番号付きリスト

番号付きリストはMarkdownにおいては、行の最初の文字が`数値`、ピリオド`.`、半角スペースの順で始まった際に、続く文章をリストの要素とみなします。その行を連続して記述することで、ひと纏まりのリストとみなされます。また、二行目以降のリスト要素においては、`数値`の前に2つ以上の半角スペースをインデントとして入力すると、前の行の子リスト要素になります。

例えば、次のようなMarkdownテキストを考えます。```
1. リストA
1. リストB
  1. 子リストB-a
    1. 孫リストB-a-a
1. リストC
```
ここで、数値に意味はなく、連番である必要はありません。逆に何かしら意味のある数値を書いても、表示には反映されません。表示の際には自動で連番になり、次のように表示されます。

1. リストA
1. リストB
  1. 子リストB-a
    1. 孫リストB-a-a
1. リストC

ちょうどHTMLでは`OL`タグと`LI`タグに相当します。

NowTypeにおける入力では、番号付きリストは次のように記入支援が行われます。

- 空の段落、もしくは、既存の段落の先頭にカーソルを合わせ、任意の`数値`とピリオド`.`を入力したあと、**半角スペース**を入力すると、段落がリストに変更されます。見出しの作り方と同じです。
- 段落の階層の上げ下げは、番号無しリストと同様に、要素の文字列の先頭で`Tab`や`Shift + Tab`を入力してください。

## 強調

Markdownでは、アスタリスク`*`で文字列を挟むことで強調表示されます。アスタリスクの数により、強調度合いは三段階に分かれます。通常それらは、斜体、太字、斜体＋太字で表示されます。例えば、`*italic*`、`**bold**`、`***italic+bold***`と記入すると、*italic*、**bold**、***italic+bold***と表示されます。

ここで三段階の強調は、ちょうどHTMLの`em`、`strong`、両方のネストに対応しています。

NowTypeにおける入力では、これらの強調は次のように入力支援が行われます。

- 文章中にカーソルを合わせて、アスタリスク`*`キーを1度押すと、挟み込むためのアスタリスクが二つ同時に入力されます。カーソルは二つのアスタリスクの間に合っていますので、そのまま強調したい文字列を入力してください。（ここではソース入力モードと呼びます）
- 文字列の入力が終わったら、キーボードやマウス操作でカーソルをアスタリスクの外に移動してください。表示が強調表示に変わります。
- 強調した文字列を編集したい時は、キーボードやマウス操作でカーソルをその文字列に合わせてください。再びソース入力モードに移行します。
- アスタリスクの間に何も入力しないまま、もしくはアスタリスク間の文字を全て削除した状態で、カーソルをアスタリスクの外側に移動すると、強調文字列を消したことになり、両側のアスタリスクも消えます。
- アスタリスク`*`キーを2度、もしくは、3度押せば第二段階(bold)、第三段階(italic+bold)の強調表示になります。
- すでに強調表示になっている文字列に置いて、入力モードの先頭もしくは末尾に、アスタリスクを追加すれば、強調の段階を上げれます。
- 一方、入力モードでアスタリスクを一つ削除すれば、段階を下げれます。
- 文字列を選択した状態でアスタリスク`*`キーを入力すれば、選択した文字列がアスタリスクで囲まれたことになります。

## コードブロック

文字列をバッククォートで囲むと、コードブロックになります。コードブロックではインライン表示とディスプレイ表示(独立表示)が使えます。両側に1つずつのバッククォートで挟まれた文字列は、`inline code`のようにインライン表示になります。一方で、両側に3つずつのバッククォートで挟まれた文字列は、```
display style code block
function test(a, b){
   return a + b;
}
```
の様にディスプレイ表示になります。

コードブロックは、ちょうどHTMLの`PRE`タグや`CODE`タグに相当します。

NowTypeにおける入力では、これらのコードブロックは次のように入力支援が行われます。

- 基本的な入力・削除の操作は強調表示と同様です。アスタリスクの代わりにバッククォートを入力してください。
- ディスプレイ表示のコードブロック中では、改行も可能です。

### ディスプレイ表示の注意

ディスプレイ表示に関しての解釈についての注意事項を挙げます。Markdown本来のデータであるテキストデータにおいては、ディスプレイ表示のコードブロックと、その前後の段落との関係には解釈の余地があります。Markdownテキストにおいて、段落の区切りは空行によってマークアップされます。ここで、段落の文章に続いて、（改行はあってもいいが）、空行を設けずに3連バッククォートが記録されていた場合、NowTypeではディスプレイ表示コードブロックも段落内の要素とみなします。同様に、コードブロック末尾の3連バッククォートに続いて、（改行はあってもいいが）、空行を設けずに文章が記録されていた場合、コードブロックと続く文章は同じ段落の要素とみなします。アプリケーションによってこの解釈にはばらつきがあります。

具体例を挙げます。例えば、次のようなMarkdownテキストのファイルを読み込んだ時、```
ここは最初の文章です。
(空行)
''' (開始の3連バッククォートの代わり)
display mode
''' (終了の3連バッククォートの代わり)
(空行)
続きの文章です。
```
一般的にはMarkdownのプレビューでは次のようなHTMLに変換されます。```
<p>ここは最初の文章です。</p>
<pre>display mode</pre>
<p>続きの文章です。</p>
```

もしMarkdownテキストに空行が無かった場合、```
ここは最初の文章です。
''' (開始の3連バッククォートの代わり)
display mode
''' (終了の3連バッククォートの代わり)
続きの文章です。
```
解釈は人によって分かれます。NowTypeでは、次のように同じ段落の要素とみなしてHTMLを生成します。```
<p>ここは最初の文章です。
<pre>display mode</pre>
続きの文章です。</p>
```

アプリによっては、空行が無くても段落が区切られたとみなして、先のHTMLと同じ構造へ変換するものもあります。NowTypeでは段落が区切られないものとしました。もし段落を区切りたいなら、空行を入れれば良いのですから、どちらの表示もユーザーが好みで作れることになるからです。

## 数式

文字列をダラー`$`で囲むと、数式ブロックになります。数式ブロックでも、コードブロックと同じように、インライン表示とディスプレイ表示(独立表示)が使えます。両側に1つずつのダラー`$`で囲まれた文字列は$f(x) = x^2 + ax + b$のようにインライン数式になります。一方で、両側に2つずつのダラー`$`で囲まれた文字列は、$$
f(x) = \int g(x,y) dy
$$
の様にディスプレイ数式になります。

数式ブロック内での数式の記入はTeX様式の記入をしてください。表示には、KaTeXライブラリを利用して、HTMLをリアルタイム生成しています。

NowTypeにおける入力では、これらの数式ブロックは次のように入力支援が行われます。NowTypeにおいては、次のように入力します。

- 基本的な入力・削除の操作は強調表示と同様です。アスタリスクの代わりにダラー`$`を入力してください。
- ディスプレイ表示の数式ブロックと、その前後の文章では、空行がある場合のみ段落を分けます。空行が無い場合には同じ段落の要素になります。これはディスプレイ表示のコードブロックの判断基準と同じです。詳しくはコードブロックについての記述をお読みください。

### ディスプレイ表示の数式ブロックにおける複数行の記述について

ディスプレイ表示の数式ブロック中では、ソースの意味で改行コードがあっても半角スペースと同じように無視され、表示時には改行されません。実際に数式表示に置いて改行するには、TeXの様式である`\\`を入力してください。例えば、$$
x=\sqrt{y}+z\\
w = 2
$$
となります。ただし、TeXのstrictな仕様としては、ダラーで囲まれただけのディスプレイ数式ブロックでは複数行の表示はNGなようです(少なくともkatexでは)。

複数行の表示をするために、NowTypeではalign環境やaligned環境が使えます。これらは数式番号の付き方が異なります。

align環境の場合は、`$$`の内側で、数式全体の最初と最後が\begin{align}と\end{align}で囲まれている必要があります。例えば、```
$$
\begin{align}
x&=\sqrt{y}+z\\
w &= 2
\end{align}
$$
```
と入力した場合を考えます。注意点として、\begin{align}より以前、また、\end{align}より後ろには数式があってはいけません。この場合、NowTypeでは次のように表示されます。$$
\begin{align}
x&=\sqrt{y}+z\\
w &= 2
\end{align}
$$
このように、各行に数式番号が付与されます。

一方で、aligned環境では、\begin{aligned}と\end{aligned}で囲んだ複数行の式に対して一つの番号が付きます。その代わり、一部の式だけを囲むこともできます。例えば、```
$$
f(x)=9x+1\\
\begin{aligned}
x&=1+z\\
w &= xy
\end{aligned}
$$
```
の様に記入します。この場合、NowTypeでは次のように表示されます。$$
f(x)=9x+1\\
\begin{aligned}
x&=1+z\\
w &= xy
\end{aligned}
$$
下二つの数式は一纏まりとみなされ、数式番号も合わせて1つだけ付与されます。

注意点として、align環境とaligned環境のネストは禁止します。

## テーブル

Markdownではテーブルも利用できます。

Markdownテキストとして、例えば次のような文字列が読み込まれたとします。```
|項目1|項目2|項目3|
|---|---|---|
|りんご| 100円  |  3個|
|みかん|  50円  | 10個|
|いちご|        | 売り切れ|
```
ここで、一行目は見出し(ヘッダー)になっており、バーティカルバー`|`でカラムの区切りを意味します。二行目は見出しとデータ行の区切り線です。実は多くのアプリにおいて、二行目にこの区切り線の行があるかないかがテーブルと見なすかどうかの判定基準になります。また、区切り線の行は列ごとの左寄せ・中央寄せ・右寄せの指示にも使われます。三行目以降はデータ行です。

上記の例の場合、次のように表示されます。

|項目1|項目2|項目3|
|---|---|---|
|りんご|100円|3個|
|みかん|50円|10個|
|いちご||売り切れ|

ちょうどHTMLでは`TABLE`タグに相当します。

NowTypeにおけるテーブルの操作では、次のような入力支援があります。

- テーブルの生成は、空の段落において、バーティカルバー、数値、アルファベットのxを用い、`|列数 x 行数|`と入力します。最後のバーティカルバーを入力したタイミングでテーブルが生成されます。ㇲペースは無視します。上記の例ですと、`|3x4|`と入力すればテーブルが作られます。
- テーブル生成時にはアルファベットxの代わりに、カンマ`,`を用いて`|3,4|`と書くこともできます。
- 列を追加する場合、ヘッダー行の要素にカーソルを合わせて、バーティカルバー`|`を入力すると、列が追加されます。この時、要素の文字列の先頭にカーソルがあったなら左隣に、それ以外なら右隣に列が追加されます。
- 列を削除する場合、ヘッダー行の要素の文字列の先頭にカーソルを合わせて`Backspace`を入力すると、現在の列と左隣の列が合成されます。また、ヘッダー行の要素の文字列の末尾にカーソルを合わせて`Delete`を入力すると、現在の列と右隣の列が合成されます。
- 行を追加する場合、データ行の左端カラムの文字列先頭にカーソルを合わせて`Enter`を入力すると、上に行を追加します。データ行の右端カラムの文字列末尾にカーソルを合わせて`Enter`を入力すると、下に行を追加します。
- 行を削除する場合、データ行の左端カラムの文字列先頭にカーソルを合わせて`Backspace`を入力すると、現在の行を削除します。データ行の右端カラムの文字列末尾にカーソルを合わせて`Delete`を入力すると、下の行を削除します。
- データ行のカラムのシフトが可能です。
- 右シフトする場合、目的のカラムの文字列中にカーソルを合わせてバーティカルバー`|`を入力すると、カーソル位置で文字列を分割し、後者及び、以降のカラムを右にシフトします。右シフトにより、右端のカラムの内容は削除されます。
- 左シフトする場合、目的のカラムの文字列先頭にカーソルを合わせて`Backspace`を入力すると、現在のカラムを含めて、以降のカラムを左にシフトします。文字列末尾で`Delete`を入力すると、現在のカラムを含めず、以降のカラムを左にシフトします。

## URLリンク

MarkdownではURLリンクを記述できます。

例として次のようなMarkdownテキストを考えます。```
[表示する文字列](index.html)
```
これは次のようなURLリンクとして表示されます。

[表示する文字列](index.html)

これはちょうどHTMLの`A`タグに相当します。

また、URLリンクはインラインブロックとして生成されます。そのため、```
東海地方の鰻のかば焼きはカリッと焼きあげられていて香ばしい
[(参考リンク)](index.html)。
```
のようなMarkdownテキストからは、次のような表示が行われます。

東海地方の鰻のかば焼きはカリッと焼きあげられていて香ばしい[(参考リンク)](index.html)。

NowTypeにおいては、次のような入力支援を行います。

- 丸括弧`(`を入力した時に、直前の文字列が各括弧で囲まれた`[...]`だった場合に、URLリンクへと切り替わります。また、直前の文字列が`![...]`だった場合には、後述の画像へと切り替わります。強調表示や数式ブロックの様に入力モードになっていますので、目的のURLや相対パスを丸括弧の間に記入して下さい。
- カーソルが入力要素から抜け出すと、<A>タグ相当の表示に切り替わります。
- 再編集したい時は、表示部分に再びカーソルを合わせてください。
- 削除したい時は、最初の`[`と末尾の`)`の間の全ての文字を消してから、カーソルを外に移すことで削除となります。

## 画像とキャプション

Markdownでは画像ファイルを張り込めます。ただし、文章ファイル自体の保存形式はテキストデータですので、画像データは埋め込みません。あくまで、画像ファイルのパスを記録し、それを基に表示させるだけです。

Markdownテキストとしては、先のURLリンクの各括弧`[`の前にエクスクラメーションマーク`!`を追加したものになります。また、URLリンク同様にインラインブロックになります。例として次のようなMarkdownテキストを考えます。```
画像![ALT属性として登録する文字列](icon256x256.png)も表示させられます。
```
これは次のような文章としてとして表示されます。

画像も![ALT属性として登録する文字列](icon256x256.png)も表示させられます

NowTypeにおいては、次のような入力支援を行います。

- 丸括弧`(`を入力した時に、直前の文字列が`![...]`だった場合には、画像へと切り替わります。強調表示や数式ブロックの様に入力モードになっていますので、目的の画像への相対パスを丸括弧の間に記入して下さい。
- カーソルが入力要素から抜け出すと、<IMG>タグ相当の表示に切り替わります。
- 再編集したい時は、表示部分に再びカーソルを合わせてください。
- 削除したい時は、最初の`![`と末尾の`) `の間の全ての文字を消してから、カーソルを外に移すことで削除となります。

**注意１**：webブラウザ版では、セキュリティーの観点からローカルファイル操作への制限があり、相対パスでの指定では上手く動きません。

**注意2**：NowTypeでは表示機能としてHTMLの機能を使っているので、表示させられる画像フォーマットとしてはjpg,png,gifなどのwebブラウザで表示できるものだけです。論文等の印刷物で良く用いられたeps形式等は今のところ表示できません。

### 画像のキャプションについて

ところで、画像にキャプション(figure caption)を加えたいという要望はあるでしょう。しかし、Markdownにおいてはキャプションの記述位置に関して様々な解釈がなされています。例えば各括弧`[]`内部の文字列をキャプションとして解釈するアプリがあります。しかしその場合、キャプション中にインラインの数式などを記述しようとすると、`[]`内部に特殊な文字が並ぶことになり、`A`タグのALT属性として登録するのは相応しくないと考えられます。最悪のケースとして表示用のHTMLが破壊されます。

そこで、NowTypeでは次の条件を満たした時に、画像をインライン表示ではなく、ディスプレイ表示と見なし、キャプションを追加します。

- 画像用のMarkdownテキスト`![Alt](path)`が段落の先頭にある場合、この画像はディスプレイ表示とする。
- ディスプレイ表示と見なした場合、元の段落内で画像に続く文章・要素はキャプションと見なす。

例として、次のMarkdownテキストを考えます。```
段落1の文章
(空行)
![Fig1](icon256x256.png)Fig1. ここに書いた文章がcaptionとみなされる。
数式$x=y$や**強調表示**も記述できる。
(空行)
段落2の文章
```
これは、HTMLとしてはFIGUREタグとFIGCAPTIONタグを使って次のように変換されます。```
<p>段落1の文章</p>
<figure>
<img alt='Fig1' src='icon256x256.png'>
<figcaption>
Fig.1 ここに書いた文章がcaptionとみなされる。
数式<span (generated by KaTeX)>x=y</span>や
<strong>強調表示</strong>も記述できる。
</figcaption>
</figure>
<p>段落2の文章</p>
```

そして、実際にNowTypeでは次のように表示されます。

段落1の文章

![Fig1](icon256x256.png)
Fig.1 ここに書いた文章がcaptionとみなされる。数式$x=y$や**強調表示**も記述できる。

段落2の文章

## 引用(citation)と注釈(footnote)

Markdownでは引用(citation)と注釈(footnote)に関しては、それらを統合したような機能があります。NowTypeでは主として引用として利用することを想定しています。

として[^tag]という表記および

[^tag] Atsushi M. Ito, 2020.

という表現が可能です。

例として次のようなMarkdownテキストを考えます。```
NowType[^tag]は2019年から開発が開始されました。
バグ報告や機能要望を挙げてくれるユーザーによって支えられています。
```
これは次のような引用リンクとして表示されます。

NowType[^tag]は2019年から開発が開始されました。バグ報告や機能要望を挙げてくれるユーザーによって支えられています。

これはHTMLの`A`タグを利用して表示しています。引用リンクはインラインブロックとして生成されます。

また、引用先の詳細情報として、著者名、年、出版物情報などを記述するには、文末もしくは注釈として記載したい場所に、以下の様に記述することになります。```
[^tag]: Author Name, 2020.
```
ここから、次のような表示が行われます。

[^tag]: Author Name, 2020.

場合によってリンクを記述するには、`[]()`を利用したリンクを次の様に書きます。```
[^tag]: Author Name, 2020, [GitHub](index.html)
```
ここから、次のような表示が行われます。

[^tag]: Author Name, 2020, [GitHub](index.html)

NowTypeにおいては、次のような入力支援を行います。

- 各括弧`[`に続いて`^`を入力すると、引用リンクになります。
- カーソルが入力要素から抜け出すと、相当するHTMLタグに切り替わります。
- 再編集したい時は、表示部分に再びカーソルを合わせてください。
- 削除したい時は、最初の`[^`と末尾の`]`の間の全ての文字を消してから、カーソルを外に移すことで削除となります。
- また、引用リンク`[^tag] `が段落の先頭に来た場合には、それを引用先の詳細情報`[^tag]:`とみなします。

## まとめ

この様に、Markdownは文章作成に必要な機能の殆どを備えています。そして、NowTypeはWYSIWYG形式のMarkdownエディターとして開発しました。特に、入力操作に関しては、シンプルなテキストエディタにてMarkdownテキストを記述する場合に出来るだけ近い自然な操作感となる様に注意しました。

NowTypeが皆様の文章作成のお役に立てば幸いです。
